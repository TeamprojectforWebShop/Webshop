<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="common">

<!-- 새로 추가됨! -->
<!-- 장바구니 삭제 -->
	<delete id="deletecart" parameterType="hashmap">
		delete from ${table}
		where idx = ${idx}
	</delete>
	
	<!-- 장바구니 조회용 -->
	<select id="resultcart" parameterType="hashmap" resultType="hashmap">
		select *
		from ${table}
		where id = '${id}'
	</select>

<!-- 구매버튼을 누르면 발생함 -->
	<insert id="addcart" parameterType="hashMap">
		insert into ${table} (id, prodCode, prodName, size, color, count, price)
		values(
			#{id},
			#{prodCode},
			#{prodName},
			#{size},
			#{color},
			#{count},
			#{price}
		)
	</insert>
	
	<!-- 체크박스로 데이터 보내기 -->
	<select id="checkcart" parameterType="hashMap" resultType="hashmap">
		select *
		from ${table}
		where idx in (
		<foreach collection="box" item="item" separator=", ">
			#{item} 
		</foreach>
		)
	</select>
	
	<!-- 계산 -->
	<insert id="order" parameterType="hashMap">
		insert into ${table} (custId, custName, prodCode, size, color, qty, price, name, phone, addr, addr2, addr3, addr4, addr5, shipStat)
		values (
		#{custId}, #{custName},#{prodCode}, #{size}, #{color}, #{qty}, #{price}, #{name}, #{phone},
		#{addr}, #{addr2}, #{addr3}, #{addr4}, #{addr5}, #{shipStat}
		)
	</insert>
	
<!-- select	 -->

	<!-- 아이디 중복체크 -->
	 <select id="idcheck" parameterType="String" resultType="Integer">
	    select count(*) from customer_manage 
	    where id = #{id}
	 </select>

	<!-- 제품 상세페이지 문장 -->
	<select id="detailPage" parameterType="hashMap" resultType="hashMap">
		SELECT * 
		FROM test_goods
		where product_code = #{product_code}
	</select>
	
	<!-- 제품 리스트 문장 -->
	<select id="getList" parameterType="hashMap" resultType="hashmap">
		SELECT *
		FROM test_goods
	</select>
	
	<!-- 장바구니 -->
	<insert id="cart" parameterType="hashMap">
		insert into ${table} (id, product_code, size, color_name, count, price)
		values(
			#{id},
			#{product_code},
			#{size},
			#{color_name},
			#{count},
			#{price}
		)
	</insert>
	
	<!-- 게시판 -->
   <insert id="boardwrite" parameterType="hashMap">
      insert into board_manage( title, content, writer)
      VALUES(
            #{title}, 
            #{content}, 
            #{writer}
      )

   </insert>
	
	<select id="search" parameterType="hashMap" resultType="hashmap">
		SELECT *
		FROM test_goods
			WHERE product_name LIKE concat('%',#{search},'%')
	</select>
	
	
	<select id="loginCheck" parameterType="hashMap" resultType="hashmap">
		SELECT * 
		FROM customer_manage
		WHERE id = #{id} AND pwd = #{pwd}
	</select>
	
<!-- 관리자 페이지 유저 정보 -->		
	<select id="userList" parameterType="hashMap" resultType="hashmap">
		SELECT
			 id
			 , name
			 , pwd
			 , email
			 , custRank
			 , joinDate
		FROM customer_manage		
	<choose>
		<when test="condition == 'id' and keyword != ('')">
			WHERE id LIKE concat('%',#{keyword},'%')
		</when>					
		<when test="condition == 'name' and keyword != ('')">
			WHERE name LIKE concat('%',#{keyword},'%')  
		</when>
		<when test="condition == 'custRank' and keyword !=('')">
			WHERE custRank LIKE concat('%',#{keyword},'%')
		</when>
	</choose>
	</select>
	
	<update id="updateUser" parameterType="hashMap" >
		UPDATE customer_manage
		SET custRank = #{custRank}
		WHERE id = #{id}
				
	</update>
	
	<delete id="deleteUser" parameterType="hashMap">
	DELETE FROM customer_manage
	WHERE id = #{id}
	</delete>
	
<!-- 관리자 페이지 물품목록 -->		
	<!--  select id="productList" parameterType="hashMap" resultType="hashmap">
		SELECT *
		FROM test_goods
		<choose>
			<when test="condition == 'product_name' and keyword != ('')">
				WHERE product_name LIKE concat('%',#{keyword},'%')
			</when>					
			<when test="condition == 'product_code' and keyword != ('')">
				WHERE product_code LIKE concat('%',#{keyword},'%')  
			</when>
			<when test="condition == 'color_name' and keyword !=('')">
				WHERE color_name LIKE concat('%',#{keyword},'%')
			</when>
			<when test="condition == 'gender' and keyword !=('')">
				WHERE gender LIKE concat('%',#{keyword},'%')
			</when>
		</choose>
	</select>-->
	

	<select id="productList" parameterType="hashMap" resultType="hashmap">
		SELECT im_db.product_detail.*, im_db.product_title.gender
		FROM im_db.product_detail
		LEFT OUTER JOIN im_db.product_title ON im_db.product_detail.product_code = im_db.product_title.product_code
		<choose>				
			<when test="condition == 'product_code' and keyword != ('')">
				WHERE im_db.product_detail.product_code LIKE concat('%',#{keyword},'%')  
			</when>
			<when test="condition == 'color_name' and keyword !=('')">
				WHERE color_name LIKE concat('%',#{keyword},'%')
			</when>
			<when test="condition == 'gender' and keyword !=('')">
				WHERE gender LIKE concat('%',#{keyword},'%')
			</when>
		</choose>
	</select>
	
	<update id="updateOrder" parameterType="hashMap" >
		UPDATE order_manage
		SET shipStat = #{shipStat}
		WHERE custId = #{custId}
				
	</update>
	
	<delete id="deleteProduct" parameterType="hashMap">
	DELETE FROM test_goods
	WHERE product_code = #{product_code}
	</delete>
	
<!-- 관리자 페이지 주문목록 -->		

	<select id="orderList" parameterType="hashMap" resultType="hashmap">
		SELECT *
		FROM order_manage
	<choose>
		<when test="condition == 'custId' and keyword != ('')">
			WHERE id LIKE custId('%',#{keyword},'%')
		</when>					
		<when test="condition == 'shipStat' and keyword != ('')">
			WHERE shipStat LIKE concat('%',#{keyword},'%')  
		</when>
		<when test="condition == 'orderNo' and keyword !=('')">
			WHERE orderNo LIKE concat('%',#{keyword},'%')
		</when>
	</choose>
	</select>

		
	<delete id="deleteOrder" parameterType="hashMap">
	DELETE FROM order_manage
	WHERE orderNo = #{orderNo}
	</delete>
	
	
<!-- insert	 -->

	<insert id="joinCheck" parameterType="hashMap" >
		insert into customer_manage (id, pwd, name, addr, addr2, addr3, addr4, addr5, contact, email, sex, birth)
			values(
					#{id},
					#{pwd},
					#{name},
					#{addr},
					#{addr2},
					#{addr3},
					#{addr4},
					#{addr5},
					#{contact},
					#{email},
					#{sex},
					#{birth}
				)
	</insert>
	
<!-- update	 -->
	<update id="updateMember" parameterType="hashMap">
	
		update customer_manage
		set
			pwd = #{pwd},
			name = #{name},
			addr = #{addr},
			addr2 = #{addr2},
			addr3 = #{addr3},
			addr4 = #{addr4},
			addr5 = #{addr5},
			contact = #{contact},
			email = #{email}
		where id = #{id}
	
	</update>
	
	
</mapper>

		
<!--	<select id="selectMyoderGoodsList" parameterType="hashMap" resultType="hashMap">
		상품 목록 저장한 테이블 넣기
	</select> -->